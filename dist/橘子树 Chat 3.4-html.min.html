<!DOCTYPE html><html lang="zh-cn" class="orange"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>橘子树 Chat</title><script>function heartbeat(e){console.log("heartbeat"),e.send(METADATA.heartbeat)}function format_time(e){return e.toTimeString().substring(0,5)}function add(e,t,r){var n=r?"me":"msg",o=document.createElement("div");if(o.classList.add(n),t.match(METADATA.file_regxp)){var a=t.substring(14,t.length-1);a=a.startsWith("http")?a:`http://${a}`,a=a.replace(":8080",":86"),o.innerHTML=`<a href="${a}" target="_blank">查看文件</a><details><summary>预览</summary><iframe src="${a}" frameborder="0">无法预览文件</iframe></details>`}else o.innerText=t;if(o.setAttribute("user",e),last_time!==format_time(new Date)){var s=document.createElement("div");s.classList.add("info"),s.innerText=format_time(new Date),document.querySelector("#messages").append(s),last_time=format_time(new Date)}document.querySelector("#messages").append(o);var i=document.querySelectorAll("#messages > div");for(var u of i)u.hasAttribute("user")&&(u.classList.contains("msg")?u.setAttribute("style",`--user: "[ ${u.getAttribute("user")} ] :";`):u.classList.contains("me")&&u.setAttribute("style",`--user: ": [ ${u.getAttribute("user")} ]";`));document.querySelector("#messages").scrollTop=document.querySelector("#messages").scrollHeight}function send(e,t,r){e.send(t+METADATA.version_id+r)}function login(e,t){var r=new WebSocket(METADATA.account_server);r.addEventListener("open",n=>{console.log(`登录<@*%*@>${e}<@*%*@>${t}`),r.send(`登录<@*%*@>${e}<@*%*@>${t}`)}),r.addEventListener("message",t=>{if(console.log(t.data),"<*假*>"===t.data){document.querySelector("#login_btn").innerText="登录 - 登录失败";var r=document.createElement("div");r.innerHTML=METADATA.login_error,document.querySelector("#login > .inner").append(r)}else{username=e,readonly=!1;r=document.createElement("div");r.innerText="登录为："+username,r.classList.add("info"),document.querySelector("#messages").append(r),document.querySelector("#login").style.display="none"}})}function register(e,t){var r=new WebSocket(METADATA.account_server);r.addEventListener("open",n=>{console.log(`注册<@*%*@>${e}<@*%*@>${t}`),r.send(`注册<@*%*@>${e}<@*%*@>${t}`),alert("注册成功")})}const METADATA={version_id:"@#y!h(d^l?",separator:"：",server:"ws://111.67.198.246:5355",account_server:"ws://111.67.198.246:1145",heartbeat:"HeartBeat",file_regxp:/^我发了一个文件，下载(链接|连接)是（.+）$/,login_error:'<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=333750&auto=1&height=66"></iframe>'};var last_time="00:00",username="Unknown",readonly=!0;document.addEventListener("DOMContentLoaded",e=>{function t(){readonly?alert("当前为未登录模式，请登录后发送消息"):(send(r,username,document.querySelector("#input > input").value),document.querySelector("#input > input").value="")}console.log(METADATA.server);var r=new WebSocket(METADATA.server);r.addEventListener("open",e=>{setInterval(()=>{heartbeat(r)},1e4)}),r.addEventListener("message",e=>{var t=e.data.split(METADATA.separator)[0]||"匿名用户",r=e.data.split(METADATA.separator)[1];add(t,r,t===username)}),r.addEventListener("error",e=>{alert("发生错误")}),document.body.addEventListener("keyup",e=>{"v"===e.key&&heartbeat(r)}),document.querySelector("#input > button").addEventListener("click",t),document.querySelector("#input > input").addEventListener("keydown",e=>{"Enter"===e.key&&t()}),document.querySelector("#theme").addEventListener("change",e=>{document.querySelector("html").className=document.querySelector("#theme").value}),document.querySelector("#login_btn").addEventListener("click",e=>{document.querySelector("#login_btn").innerText="登录 - 请稍后",document.querySelector("#login_btn").setAttribute("disabled",""),setTimeout(()=>{login(document.querySelector("#username").value,document.querySelector("#password").value),document.querySelector("#login_btn").innerText="登录",document.querySelector("#login_btn").removeAttribute("disabled")},500)}),document.querySelector("#register_btn").addEventListener("click",e=>{document.querySelector("#register_btn").innerText="注册 - 请稍后",document.querySelector("#register_btn").setAttribute("disabled",""),setTimeout(()=>{register(document.querySelector("#username").value,document.querySelector("#password").value),document.querySelector("#register_btn").innerText="注册",document.querySelector("#register_btn").removeAttribute("disabled")},500)}),document.querySelector("#readonly_btn").addEventListener("click",e=>{document.querySelector("#login").style.display="none"})});</script><style>html.orange{--background:#fb0;--accent:#000;--message-background:orange;--info-background:#555}html.dark{--background:#222;--accent:#eee;--message-background:#444;--info-background:#777}html.light{--background:#ddd;--accent:#111;--message-background:#ccc;--info-background:#777}*{font-family:system-ui,sans-serif;transition:background-color .3s,color .3s}body{width:100vw;height:100vh;overflow:hidden;background-color:var(--background);margin:0;padding:0;display:grid;grid-template-rows:4em calc(100% - 7em) 3em}nav{display:flex;align-items:center;color:var(--accent);border-bottom:2px solid var(--accent)}nav>h3{margin:1em;display:inline}nav>select{height:2em}#messages{display:block;padding:1em;overflow-y:scroll}#messages::-webkit-scrollbar{width:.5em;background-color:var(--message-background)}#messages::-webkit-scrollbar-thumb{background-color:var(--info-background);border-radius:10px}#messages::-webkit-scrollbar-button{height:0}#messages>*{margin:1em;display:inline;width:max-content;color:var(--accent);clear:both}#messages>div.info{text-align:center;margin:1em auto;display:block;width:100%;color:var(--info-background)}#messages>div.me,#messages>div.msg{background-color:var(--message-background);padding:1em;border-radius:10px;max-width:60%;--user:"Unknown"}#messages>div.me>details>iframe,#messages>div.msg>details>iframe{height:40vh}#messages>div.msg::before{content:var(--user);margin-right:.8em;color:var(--info-background)}#messages>div.me::after{content:var(--user);margin-left:.8em;color:var(--info-background)}#messages>div.msg{text-align:left;float:left}#messages>div.me{text-align:right;float:right}#input{display:grid;grid-template-columns:auto 20%}#input>*{height:100%;border:none;background-color:var(--message-background);color:var(--accent)}#login{position:fixed;width:100vw;height:100vh;z-index:999;backdrop-filter:blur(3px);display:flex;justify-content:center;align-items:center}#login>.inner{background-color:var(--message-background);padding:2em;border-radius:20px}#login>.inner h3{margin-top:0}#login>.inner input{display:block;margin:1em 0}#login>.inner button{margin-bottom:.4em}a{color:inherit;text-decoration:none}example{display:none!important}</style></head><body><nav><h3>橘子树 Chat</h3><select id="theme"><optgroup label="主题设置"><option value="light">浅色</option><option value="dark">深色</option><option value="orange" selected>橙色</option></optgroup></select></nav><div id="messages"><div class="info">欢迎使用：橘子树 Chat</div><div class="info">版本：3.4-html</div><div class="info">官方交流群：938770865</div></div><div id="input"><input type="text"> <button>发送</button></div><div id="login"><div class="inner"><h3>登录</h3><input type="text" id="username" placeholder="用户名"> <input type="password" id="password" placeholder="密码"> <input type="password" id="password2" placeholder="确认密码（注册时填写）"> <button id="login_btn">登录</button> <button id="register_btn">注册</button><br><button id="readonly_btn">不登录直接使用（不能发消息）</button></div></div></body></html>