<!DOCTYPE html><html lang="zh-cn" class="orange"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>橘子树 Chat</title><script>function heartbeat(e){console.log("heartbeat"),e.send(METADATA.heartbeat)}function format_time(e){return e.toTimeString().substring(0,5)}function add(e,t,r){var a=r?"me":"msg",n=document.createElement("div");if(n.classList.add(a),t.match(METADATA.file_regxp)){var s=t.substring(14,t.length-1);s=s.startsWith("http")?s:`http://${s}`,s=s.replace(":8080",":86"),n.innerHTML=`<a href="${s}" target="_blank">查看文件</a><details><summary>预览</summary><iframe src="${s}" frameborder="0">无法预览文件</iframe></details>`}else n.innerText=t;if(n.setAttribute("user",e),last_time!==format_time(new Date)){var o=document.createElement("div");o.classList.add("info"),o.innerText=format_time(new Date),document.querySelector("#messages").append(o),last_time=format_time(new Date)}document.querySelector("#messages").append(n);var i=document.querySelectorAll("#messages > div");for(var u of i)u.hasAttribute("user")&&(u.classList.contains("msg")?u.setAttribute("style",`--user: "[ ${u.getAttribute("user")} ] :";`):u.classList.contains("me")&&u.setAttribute("style",`--user: ": [ ${u.getAttribute("user")} ]";`));document.querySelector("#messages").scrollTop=document.querySelector("#messages").scrollHeight}function send(e,t,r){e.send(t+METADATA.version_id+r)}const METADATA={version_id:"@#y!h(d^l?",separator:"：",server:"ws://111.67.198.246:5355",heartbeat:"HeartBeat",file_regxp:/^我发了一个文件，下载(链接|连接)是（.+）$/};last_time="00:00",document.addEventListener("DOMContentLoaded",e=>{function t(){send(r,a,document.querySelector("#input > input").value),document.querySelector("#input > input").value=""}console.log(METADATA.server);var r=new WebSocket(METADATA.server),a=prompt("服务器连接成功，请输入你的名字：（留空匿名）")||"匿名用户"+Math.random().toString().split(".")[1].substring(0,5);console.log(a),r.addEventListener("open",e=>{setInterval(()=>{heartbeat(r)},1e4)}),r.addEventListener("message",e=>{var t=e.data.split(METADATA.separator)[0]||"匿名用户",r=e.data.split(METADATA.separator)[1];add(t,r,t===a)}),r.addEventListener("error",e=>{alert("发生错误")}),document.body.addEventListener("keyup",e=>{"v"===e.key&&heartbeat(r)}),document.querySelector("#input > button").addEventListener("click",t),document.querySelector("#input > input").addEventListener("keydown",e=>{"Enter"===e.key&&t()}),document.querySelector("#theme").addEventListener("change",e=>{document.querySelector("html").className=document.querySelector("#theme").value})});</script><style>html.orange{--background:#fb0;--accent:#000;--message-background:orange;--info-background:#555}html.dark{--background:#222;--accent:#eee;--message-background:#444;--info-background:#777}html.light{--background:#ddd;--accent:#111;--message-background:#ccc;--info-background:#777}*{font-family:system-ui,sans-serif;transition:background-color .3s,color .3s}body{width:100vw;height:100vh;overflow:hidden;background-color:var(--background);margin:0;padding:0;display:grid;grid-template-rows:4em calc(100% - 7em) 3em}nav{display:flex;align-items:center;color:var(--accent);border-bottom:2px solid var(--accent)}nav>h3{margin:1em;display:inline}nav>select{height:2em}#messages{display:block;padding:1em;overflow-y:scroll}#messages::-webkit-scrollbar{width:.5em;background-color:var(--message-background)}#messages::-webkit-scrollbar-thumb{background-color:var(--info-background);border-radius:10px}#messages::-webkit-scrollbar-button{height:0}#messages>*{margin:1em;display:inline;width:max-content;color:var(--accent);clear:both}#messages>div.info{text-align:center;margin:1em auto;display:block;width:100%;color:var(--info-background)}#messages>div.me,#messages>div.msg{background-color:var(--message-background);padding:1em;border-radius:10px;max-width:60%;--user:"Unknown"}#messages>div.me>details>iframe,#messages>div.msg>details>iframe{height:40vh}#messages>div.msg::before{content:var(--user);margin-right:.8em;color:var(--info-background)}#messages>div.me::after{content:var(--user);margin-left:.8em;color:var(--info-background)}#messages>div.msg{text-align:left;float:left}#messages>div.me{text-align:right;float:right}#input{display:grid;grid-template-columns:auto 20%}#input>*{height:100%;border:none;background-color:var(--message-background);color:var(--accent)}a{color:inherit;text-decoration:none}example{display:none!important}</style></head><body><nav><h3>橘子树 Chat</h3><select id="theme"><optgroup label="主题设置"><option value="light">浅色</option><option value="dark">深色</option><option value="orange" selected>橙色</option></optgroup></select></nav><div id="messages"><div class="info">欢迎使用：橘子树 Chat</div><div class="info">版本：3.3-html</div><div class="info">官方交流群：938770865</div></div><div id="input"><input type="text"> <button>发送</button></div></body></html>